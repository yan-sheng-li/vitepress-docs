import{_ as a,c as e,o as n,aj as t}from"./chunks/framework.VtnL2jmu.js";const g=JSON.parse('{"title":"vuex-persistedstate","description":"","frontmatter":{},"headers":[],"relativePath":"vue/æ’ä»¶persistedstate.md","filePath":"vue/æ’ä»¶persistedstate.md"}'),i={name:"vue/æ’ä»¶persistedstate.md"};function p(l,s,r,o,d,c){return n(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="vuex-persistedstate" tabindex="-1">vuex-persistedstate <a class="header-anchor" href="#vuex-persistedstate" aria-label="Permalink to â€œvuex-persistedstateâ€">â€‹</a></h1><blockquote><p><code>vuex-persistedstate</code> æ˜¯ä¸€ä¸ªç”¨äº <strong>æŒä¹…åŒ– Vuex çŠ¶æ€</strong> çš„æ’ä»¶ï¼Œå¯ä»¥å°† Vuex ä¸­çš„æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå¦‚ <code>localStorage</code> æˆ– <code>sessionStorage</code>ï¼‰ï¼Œé˜²æ­¢é¡µé¢åˆ·æ–°åæ•°æ®ä¸¢å¤±ã€‚ä»¥ä¸‹æ˜¯å®ƒåœ¨ <strong>Vue 2 é¡¹ç›®</strong>ä¸­çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼š</p></blockquote><hr><h2 id="_1-å®‰è£…" tabindex="-1"><strong>1. å®‰è£…</strong> <a class="header-anchor" href="#_1-å®‰è£…" aria-label="Permalink to â€œ1. å®‰è£…â€">â€‹</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>npm install vuex-persistedstate</span></span>
<span class="line"><span># æˆ–</span></span>
<span class="line"><span>yarn add vuex-persistedstate</span></span></code></pre></div><hr><h2 id="_2-åŸºæœ¬ä½¿ç”¨" tabindex="-1"><strong>2. åŸºæœ¬ä½¿ç”¨</strong> <a class="header-anchor" href="#_2-åŸºæœ¬ä½¿ç”¨" aria-label="Permalink to â€œ2. åŸºæœ¬ä½¿ç”¨â€">â€‹</a></h2><h3 id="_2-1-åœ¨-vuex-store-ä¸­å¼•å…¥" tabindex="-1"><strong>2.1 åœ¨ Vuex Store ä¸­å¼•å…¥</strong> <a class="header-anchor" href="#_2-1-åœ¨-vuex-store-ä¸­å¼•å…¥" aria-label="Permalink to â€œ2.1 åœ¨ Vuex Store ä¸­å¼•å…¥â€">â€‹</a></h3><p>åœ¨ <code>store/index.js</code>ï¼ˆæˆ–ä½ çš„ Vuex é…ç½®æ–‡ä»¶ï¼‰ä¸­å¼•å…¥å¹¶é…ç½®ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>import Vue from &#39;vue&#39;;</span></span>
<span class="line"><span>import Vuex from &#39;vuex&#39;;</span></span>
<span class="line"><span>import createPersistedState from &#39;vuex-persistedstate&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Vue.use(Vuex);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export default new Vuex.Store({</span></span>
<span class="line"><span>  state: {</span></span>
<span class="line"><span>    user: null,</span></span>
<span class="line"><span>    token: &#39;&#39;,</span></span>
<span class="line"><span>    theme: &#39;light&#39;,</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  mutations: {</span></span>
<span class="line"><span>    setUser(state, user) {</span></span>
<span class="line"><span>      state.user = user;</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    setToken(state, token) {</span></span>
<span class="line"><span>      state.token = token;</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    setTheme(state, theme) {</span></span>
<span class="line"><span>      state.theme = theme;</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  plugins: [</span></span>
<span class="line"><span>    // é»˜è®¤ä½¿ç”¨ localStorage å­˜å‚¨æ‰€æœ‰ state</span></span>
<span class="line"><span>    createPersistedState(),</span></span>
<span class="line"><span>  ],</span></span>
<span class="line"><span>});</span></span></code></pre></div><h3 id="_2-2-æµ‹è¯•æ•ˆæœ" tabindex="-1"><strong>2.2 æµ‹è¯•æ•ˆæœ</strong> <a class="header-anchor" href="#_2-2-æµ‹è¯•æ•ˆæœ" aria-label="Permalink to â€œ2.2 æµ‹è¯•æ•ˆæœâ€">â€‹</a></h3><ul><li><p>åœ¨ Vue ç»„ä»¶ä¸­ä¿®æ”¹ Vuex çŠ¶æ€ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>this.$store.commit(&#39;setUser&#39;, { name: &#39;John&#39; });</span></span>
<span class="line"><span>this.$store.commit(&#39;setToken&#39;, &#39;abc123&#39;);</span></span></code></pre></div></li><li></li></ul><p>åˆ·æ–°é¡µé¢</p><p>ï¼Œæ£€æŸ¥</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>localStorage</span></span></code></pre></div><p>ï¼ˆå¼€å‘è€…å·¥å…· â†’ Application â†’ Local Storageï¼‰ï¼Œä¼šå‘ç°æ•°æ®å·²è¢«ä¿å­˜ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;user&quot;: { &quot;name&quot;: &quot;John&quot; },</span></span>
<span class="line"><span>  &quot;token&quot;: &quot;abc123&quot;,</span></span>
<span class="line"><span>  &quot;theme&quot;: &quot;light&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>é‡æ–°åŠ è½½é¡µé¢åï¼ŒVuex ä¼šè‡ªåŠ¨ä» <code>localStorage</code> æ¢å¤æ•°æ®ã€‚</li></ul><hr><h2 id="_3-é«˜çº§é…ç½®" tabindex="-1"><strong>3. é«˜çº§é…ç½®</strong> <a class="header-anchor" href="#_3-é«˜çº§é…ç½®" aria-label="Permalink to â€œ3. é«˜çº§é…ç½®â€">â€‹</a></h2><h3 id="_3-1-åªæŒä¹…åŒ–éƒ¨åˆ†-state" tabindex="-1"><strong>3.1 åªæŒä¹…åŒ–éƒ¨åˆ† state</strong> <a class="header-anchor" href="#_3-1-åªæŒä¹…åŒ–éƒ¨åˆ†-state" aria-label="Permalink to â€œ3.1 åªæŒä¹…åŒ–éƒ¨åˆ† stateâ€">â€‹</a></h3><p>å¦‚æœä¸æƒ³ä¿å­˜å…¨éƒ¨ stateï¼Œå¯ä»¥æŒ‡å®š <code>paths</code>ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>createPersistedState({</span></span>
<span class="line"><span>  paths: [&#39;user&#39;, &#39;token&#39;], // åªä¿å­˜ user å’Œ token</span></span>
<span class="line"><span>}),</span></span></code></pre></div><h3 id="_3-2-ä½¿ç”¨-sessionstorage" tabindex="-1"><strong>3.2 ä½¿ç”¨ sessionStorage</strong> <a class="header-anchor" href="#_3-2-ä½¿ç”¨-sessionstorage" aria-label="Permalink to â€œ3.2 ä½¿ç”¨ sessionStorageâ€">â€‹</a></h3><p>é»˜è®¤ä½¿ç”¨ <code>localStorage</code>ï¼Œå¦‚æœæƒ³æ”¹ç”¨ <code>sessionStorage</code>ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>createPersistedState({</span></span>
<span class="line"><span>  storage: window.sessionStorage,</span></span>
<span class="line"><span>}),</span></span></code></pre></div><h3 id="_3-3-è‡ªå®šä¹‰å­˜å‚¨-key" tabindex="-1"><strong>3.3 è‡ªå®šä¹‰å­˜å‚¨ key</strong> <a class="header-anchor" href="#_3-3-è‡ªå®šä¹‰å­˜å‚¨-key" aria-label="Permalink to â€œ3.3 è‡ªå®šä¹‰å­˜å‚¨ keyâ€">â€‹</a></h3><p>é»˜è®¤å­˜å‚¨ key æ˜¯ <code>vuex</code>ï¼Œå¯ä»¥ä¿®æ”¹ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>createPersistedState({</span></span>
<span class="line"><span>  key: &#39;my-app-vuex&#39;, // localStorage ä¸­çš„ key ä¼šå˜æˆ &quot;my-app-vuex&quot;</span></span>
<span class="line"><span>}),</span></span></code></pre></div><h3 id="_3-4-æ•°æ®åŠ å¯†-å¯é€‰" tabindex="-1"><strong>3.4 æ•°æ®åŠ å¯†ï¼ˆå¯é€‰ï¼‰</strong> <a class="header-anchor" href="#_3-4-æ•°æ®åŠ å¯†-å¯é€‰" aria-label="Permalink to â€œ3.4 æ•°æ®åŠ å¯†ï¼ˆå¯é€‰ï¼‰â€">â€‹</a></h3><p>å¦‚æœéœ€è¦åŠ å¯†å­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ <code>secure-ls</code>ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>npm install secure-ls</span></span>
<span class="line"><span>import SecureLS from &#39;secure-ls&#39;;</span></span>
<span class="line"><span>const ls = new SecureLS({ encodingType: &#39;aes&#39; });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>createPersistedState({</span></span>
<span class="line"><span>  storage: {</span></span>
<span class="line"><span>    getItem: (key) =&gt; ls.get(key),</span></span>
<span class="line"><span>    setItem: (key, value) =&gt; ls.set(key, value),</span></span>
<span class="line"><span>    removeItem: (key) =&gt; ls.remove(key),</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>}),</span></span></code></pre></div><h3 id="_3-5-æ•°æ®è¿‡æ»¤-ä¸å­˜å‚¨æŸäº›æ•°æ®" tabindex="-1"><strong>3.5 æ•°æ®è¿‡æ»¤ï¼ˆä¸å­˜å‚¨æŸäº›æ•°æ®ï¼‰</strong> <a class="header-anchor" href="#_3-5-æ•°æ®è¿‡æ»¤-ä¸å­˜å‚¨æŸäº›æ•°æ®" aria-label="Permalink to â€œ3.5 æ•°æ®è¿‡æ»¤ï¼ˆä¸å­˜å‚¨æŸäº›æ•°æ®ï¼‰â€">â€‹</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>createPersistedState({</span></span>
<span class="line"><span>  reducer: (state) =&gt; {</span></span>
<span class="line"><span>    const { token, ...persistedState } = state; // ä¸å­˜å‚¨ token</span></span>
<span class="line"><span>    return persistedState;</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>}),</span></span></code></pre></div><hr><h2 id="_4-å¸¸è§é—®é¢˜" tabindex="-1"><strong>4. å¸¸è§é—®é¢˜</strong> <a class="header-anchor" href="#_4-å¸¸è§é—®é¢˜" aria-label="Permalink to â€œ4. å¸¸è§é—®é¢˜â€">â€‹</a></h2><h3 id="_4-1-æ•°æ®æœªæ›´æ–°" tabindex="-1"><strong>4.1 æ•°æ®æœªæ›´æ–°ï¼Ÿ</strong> <a class="header-anchor" href="#_4-1-æ•°æ®æœªæ›´æ–°" aria-label="Permalink to â€œ4.1 æ•°æ®æœªæ›´æ–°ï¼Ÿâ€">â€‹</a></h3><ul><li>ç¡®ä¿ <code>mutations</code> æ­£ç¡®è§¦å‘ï¼Œå¹¶ä¸” <code>createPersistedState</code> åœ¨ <code>plugins</code> æ•°ç»„ä¸­ã€‚</li><li>æ£€æŸ¥ <code>localStorage</code> æ˜¯å¦è¢«æµè§ˆå™¨ç¦ç”¨ï¼ˆå¦‚éšç§æ¨¡å¼ï¼‰ã€‚</li></ul><h3 id="_4-2-å¦‚ä½•æ¸…é™¤å­˜å‚¨çš„æ•°æ®" tabindex="-1"><strong>4.2 å¦‚ä½•æ¸…é™¤å­˜å‚¨çš„æ•°æ®ï¼Ÿ</strong> <a class="header-anchor" href="#_4-2-å¦‚ä½•æ¸…é™¤å­˜å‚¨çš„æ•°æ®" aria-label="Permalink to â€œ4.2 å¦‚ä½•æ¸…é™¤å­˜å‚¨çš„æ•°æ®ï¼Ÿâ€">â€‹</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>// æ‰‹åŠ¨æ¸…é™¤ localStorage ä¸­çš„ Vuex æ•°æ®</span></span>
<span class="line"><span>localStorage.removeItem(&#39;vuex&#39;); // æˆ–è‡ªå®šä¹‰çš„ key</span></span>
<span class="line"><span>// æˆ–</span></span>
<span class="line"><span>this.$store.replaceState({}); // é‡ç½® Vuex çŠ¶æ€</span></span></code></pre></div><h3 id="_4-3-å…¼å®¹-ssr-å¦‚-nuxt-js" tabindex="-1"><strong>4.3 å…¼å®¹ SSRï¼ˆå¦‚ Nuxt.jsï¼‰</strong> <a class="header-anchor" href="#_4-3-å…¼å®¹-ssr-å¦‚-nuxt-js" aria-label="Permalink to â€œ4.3 å…¼å®¹ SSRï¼ˆå¦‚ Nuxt.jsï¼‰â€">â€‹</a></h3><p>åœ¨ SSR ç¯å¢ƒä¸‹ï¼ˆå¦‚ Nuxt.jsï¼‰ï¼Œ<code>window</code> å¯¹è±¡ä¸å­˜åœ¨ï¼Œéœ€è¦åŠ¨æ€å¼•å…¥ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>// ä»…åœ¨å®¢æˆ·ç«¯ä½¿ç”¨</span></span>
<span class="line"><span>if (process.client) {</span></span>
<span class="line"><span>  const createPersistedState = require(&#39;vuex-persistedstate&#39;).default;</span></span>
<span class="line"><span>  store.plugins.push(createPersistedState());</span></span>
<span class="line"><span>}</span></span></code></pre></div><hr><h2 id="_5-å®˜æ–¹æ–‡æ¡£" tabindex="-1"><strong>5. å®˜æ–¹æ–‡æ¡£</strong> <a class="header-anchor" href="#_5-å®˜æ–¹æ–‡æ¡£" aria-label="Permalink to â€œ5. å®˜æ–¹æ–‡æ¡£â€">â€‹</a></h2><ul><li>GitHub: <a href="https://github.com/robinvdvleuten/vuex-persistedstate" target="_blank" rel="noreferrer">https://github.com/robinvdvleuten/vuex-persistedstate</a></li><li>æ›´å¤šé…ç½®é€‰é¡¹ï¼š<code>createPersistedState(options)</code></li></ul><hr><h2 id="æ€»ç»“" tabindex="-1"><strong>æ€»ç»“</strong> <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to â€œæ€»ç»“â€">â€‹</a></h2><table tabindex="0"><thead><tr><th>åŠŸèƒ½</th><th>é…ç½®æ–¹å¼</th></tr></thead><tbody><tr><td><strong>åŸºæœ¬å­˜å‚¨</strong></td><td><code>createPersistedState()</code></td></tr><tr><td><strong>åªå­˜å‚¨éƒ¨åˆ† state</strong></td><td><code>paths: [&#39;user&#39;, &#39;token&#39;]</code></td></tr><tr><td><strong>æ”¹ç”¨ sessionStorage</strong></td><td><code>storage: window.sessionStorage</code></td></tr><tr><td><strong>è‡ªå®šä¹‰ key</strong></td><td><code>key: &#39;my-custom-key&#39;</code></td></tr><tr><td><strong>åŠ å¯†å­˜å‚¨</strong></td><td>ç»“åˆ <code>secure-ls</code></td></tr><tr><td><strong>æ•°æ®è¿‡æ»¤</strong></td><td><code>reducer: (state) =&gt; filteredState</code></td></tr></tbody></table><p>é€šè¿‡ <code>vuex-persistedstate</code>ï¼Œä½ å¯ä»¥è½»æ¾å®ç° Vuex æ•°æ®çš„æŒä¹…åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼ ğŸš€</p>`,50)])])}const u=a(i,[["render",p]]);export{g as __pageData,u as default};
