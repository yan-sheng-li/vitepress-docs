import{_ as i,c as a,o as e,aj as l}from"./chunks/framework.VtnL2jmu.js";const o=JSON.parse('{"title":"自制HLS视频流","description":"","frontmatter":{},"headers":[],"relativePath":"tool/自制视频流.md","filePath":"tool/自制视频流.md"}'),h={name:"tool/自制视频流.md"};function t(n,s,p,k,d,r){return e(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="自制hls视频流" tabindex="-1">自制HLS视频流 <a class="header-anchor" href="#自制hls视频流" aria-label="Permalink to “自制HLS视频流”">​</a></h1><p><img src="http://cdn.qiniu.liyansheng.top/img/image-20250208231619262.png" alt="image-20250208231619262"></p><h2 id="环境" tabindex="-1">环境 <a class="header-anchor" href="#环境" aria-label="Permalink to “环境”">​</a></h2><ul><li>操作系统：CentOS 7</li></ul><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to “简介”">​</a></h2><p>FFmpeg 是一个功能强大的开源多媒体处理工具集，包含 libavcodec、libavformat 和 libavutil 等核心库。它支持多种音视频格式的转换、采样率设置、流媒体捕获以及视频尺寸调整等操作。</p><h2 id="安装步骤" tabindex="-1">安装步骤 <a class="header-anchor" href="#安装步骤" aria-label="Permalink to “安装步骤”">​</a></h2><h3 id="_1-启用epel仓库" tabindex="-1">1. 启用EPEL仓库 <a class="header-anchor" href="#_1-启用epel仓库" aria-label="Permalink to “1. 启用EPEL仓库”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> epel-release</span></span></code></pre></div><h3 id="_2-启用rpm-fusion仓库" tabindex="-1">2. 启用RPM Fusion仓库 <a class="header-anchor" href="#_2-启用rpm-fusion仓库" aria-label="Permalink to “2. 启用RPM Fusion仓库”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localinstall</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --nogpgcheck</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm</span></span></code></pre></div><h3 id="_3-安装ffmpeg" tabindex="-1">3. 安装FFmpeg <a class="header-anchor" href="#_3-安装ffmpeg" aria-label="Permalink to “3. 安装FFmpeg”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ffmpeg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ffmpeg-devel</span></span></code></pre></div><h3 id="_4-验证安装" tabindex="-1">4. 验证安装 <a class="header-anchor" href="#_4-验证安装" aria-label="Permalink to “4. 验证安装”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span></code></pre></div><h2 id="hls流媒体制作" tabindex="-1">HLS流媒体制作 <a class="header-anchor" href="#hls流媒体制作" aria-label="Permalink to “HLS流媒体制作”">​</a></h2><h3 id="示例-将demo-mp4转换为hls格式" tabindex="-1">示例：将<code>demo.mp4</code>转换为HLS格式 <a class="header-anchor" href="#示例-将demo-mp4转换为hls格式" aria-label="Permalink to “示例：将demo.mp4转换为HLS格式”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ffmpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> demo.mp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -c:v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libx264</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -preset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ultrafast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -crf</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -c:a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aac</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -b:a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 128k</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -map</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0:v:0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -map</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0:a:0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -hls_time</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -hls_list_size</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -hls_base_url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;demo/&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       -hls_segment_filename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;demo/demo_%03d.ts&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       demo.m3u8</span></span></code></pre></div><h3 id="参数说明" tabindex="-1">参数说明 <a class="header-anchor" href="#参数说明" aria-label="Permalink to “参数说明”">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-i demo.mp4</code></td><td>指定输入文件</td></tr><tr><td><code>-c:v libx264</code></td><td>使用H.264编码器</td></tr><tr><td><code>-preset ultrafast</code></td><td>使用最快的编码预设</td></tr><tr><td><code>-crf 23</code></td><td>视频质量参数（范围0-51，值越小质量越高）</td></tr><tr><td><code>-c:a aac</code></td><td>使用AAC音频编码</td></tr><tr><td><code>-b:a 128k</code></td><td>设置音频比特率为128kbps</td></tr><tr><td><code>-map 0:v:0 -map 0:a:0</code></td><td>选择第一个视频和音频流</td></tr><tr><td><code>-f hls</code></td><td>指定输出格式为HLS</td></tr><tr><td><code>-hls_time 4</code></td><td>设置每个TS切片时长为4秒</td></tr><tr><td><code>-hls_list_size 0</code></td><td>播放列表包含所有切片</td></tr><tr><td><code>-hls_base_url &quot;demo/&quot;</code></td><td>设置切片文件的基础路径</td></tr><tr><td><code>-hls_segment_filename &quot;demo/demo_%03d.ts&quot;</code></td><td>指定切片文件命名格式</td></tr></tbody></table><p><img src="http://cdn.qiniu.liyansheng.top/img/image-20250208231245870.png" alt="image-20250208231245870"></p><p><img src="http://cdn.qiniu.liyansheng.top/img/image-20250208231334176.png" alt="image-20250208231334176"></p><h2 id="nginx服务器配置" tabindex="-1">Nginx服务器配置 <a class="header-anchor" href="#nginx服务器配置" aria-label="Permalink to “Nginx服务器配置”">​</a></h2><h3 id="文件存放路径" tabindex="-1">文件存放路径 <a class="header-anchor" href="#文件存放路径" aria-label="Permalink to “文件存放路径”">​</a></h3><p><code>/usr/share/nginx/html/video</code></p><h3 id="nginx配置示例" tabindex="-1">Nginx配置示例 <a class="header-anchor" href="#nginx配置示例" aria-label="Permalink to “Nginx配置示例”">​</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xxx.com;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /hls/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html/video/;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Origin *;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Cache-Control no-cache;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            application/vnd.apple.mpegurl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m3u8;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            video/mp2t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ts;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="配置生效" tabindex="-1">配置生效 <a class="header-anchor" href="#配置生效" aria-label="Permalink to “配置生效”">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><h2 id="播放链接示例" tabindex="-1">播放链接示例 <a class="header-anchor" href="#播放链接示例" aria-label="Permalink to “播放链接示例”">​</a></h2><p><code>http://xxx.com/hls/demo.m3u8</code></p><h2 id="播放方法" tabindex="-1">播放方法 <a class="header-anchor" href="#播放方法" aria-label="Permalink to “播放方法”">​</a></h2><ol><li>打开支持HLS的播放器（如VLC、PotPlayer等）</li><li>添加网络流，输入<code>.m3u8</code>链接</li><li>开始播放</li></ol><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to “注意事项”">​</a></h2><ul><li>确保服务器防火墙开放80端口</li><li>视频文件路径和Nginx配置中的路径需保持一致</li><li>可根据实际需求调整HLS切片时长和视频质量参数</li><li>视频太长，可以将视频切割后再分片，<a href="https://www.bandicam.com/bandicut-video-cutter/" target="_blank" rel="noreferrer">切割工具</a></li></ul>`,35)])])}const c=i(h,[["render",t]]);export{o as __pageData,c as default};
